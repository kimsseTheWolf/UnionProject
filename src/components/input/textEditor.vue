<template>
  <div class="line-edit-wrapper">
    <div class="left-bar-wrapper">
      <textarea ref="barArea" v-model="barValue" class="bar-area" wrap="off" cols="2" disabled />
    </div>
    <div class="rigth-edit-wrapper">
      <textarea ref="editArea" v-bind="contentValue" class="edit-area" name="content" @scroll="syncScrollTop" @input="$emit('update:contentValue', $event.target.value)"/>
      <!--@keyup="keyUp"-->
    </div>
  </div>
</template>
<script>
export default {
  data() {
    return {
      value: '',
      barValue: '1',
      isIE: false, // 判断浏览器是否是IE
      suffix: '\n'
    }
  },
  watch: {
    contentValue(val) {
      let str = val
      str = str.replace(/\r/gi, '')
      str = str.split('\n')
      const n = str.length
      this.line(n)
      console.log("Text Editor Line Number Triggered")
    }
  },
  mounted() {
    this.init()
  },
  methods: {
    // 初始化
    init() {
      // 判断IE
      if (document.all) {
        this.isIE = true
        this.suffix = '\r\n'
      } else {
        console.log('不是垃圾IE')
      }
    },
    // 设置行号
    line(n) {
      let num = ''
      for (let i = 1; i <= n; i++) {
        num += i + this.suffix
      }
      this.barValue = num
      console.log(this.$refs.editArea.scrollTop, this.$refs.barArea.scrollTop)
    },
    // 同步滚动
    syncScrollTop() {
      this.$refs.barArea.scrollTop = this.$refs.editArea.scrollTop
    }
  },
  props: ['contentValue'],
  emits: ['update:contentValue']
}
</script>
<style type="text/css">
*{
  margin: 0;
  padding: 0;
}
html,body{
  height: 100%;
  margin: 0;
  padding: 0;
  font: 12px/1.5 tahoma, arial, 'hiragino sans gb', 'microsoft yahei', sans-serif;
  -webkit-font-smoothing: antialiased;
}
.line-edit-wrapper{
  width:640px;
  height:800px;
}
.left-bar-wrapper{
  background:#ecf0f5;
  width:35px; height:100%;
  text-align:left;
  float: left;
}
.rigth-edit-wrapper {
  height:100%;
}
.edit-area{
  border:1px solid #eaeaea;
  outline:none;
  width:600px;
  height:100%;
  resize: none;
  background: rgb(250,250,250);
  line-height: 24px;
  font-size: 14px;
  float: left;
  padding:10px 8px;
  color: black;
  font-family: inherit;
  box-sizing: border-box;
}
.bar-area{
  height:100%;
  width: 100%;
  resize: none;
  outline:none;
  overflow-y: hidden;
  overflow-x: hidden; border: 0;
  background: rgb(247,247,247);
  color: #999;
  line-height: 24px;
  font-size: 14px;
  padding:10px 4px;
  text-align: right;
  font-weight: bold;
  box-sizing: border-box;
}
</style>
